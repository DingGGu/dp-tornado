language: python
python:
  - 2.7
  - pypy
  - 3.3
  - 3.4
  - 3.5
  - nightly
  - pypy3

services:
  - redis-server
  - mysql

install:
  - virtualenv nodeps
  - ./nodeps/bin/python setup.py install
  - . ./nodeps/bin/activate
  - python setup.py install
  - pip install python-coveralls
  - pip install nose
  - pip install CyMySQL==0.8.9
  - pip freeze

addons:
  apt:
    packages:
      - nginx

before_script:
  - sudo /etc/init.d/nginx restart
  - sudo cp ./travis/conf/nginx.conf /etc/nginx/nginx.conf
  - sudo cat /etc/nginx/nginx.conf
  - sudo ps -ef | grep nginx

  - sudo which wget
  - sudo wget http://127.0.0.1:18923 -o wget_test
  - sudo cat wget_test
  - sudo wget http://127.0.0.1:28923 -o wget_test
  - sudo cat wget_test
  - sudo rm wget_test

  - mysql -e "DROP DATABASE IF EXISTS dp_test_db;" -u root
  - mysql -e "CREATE DATABASE IF NOT EXISTS dp_test_db;" -u root

script: ./nodeps/bin/nosetests -w ./tests

after_success:
  - coveralls